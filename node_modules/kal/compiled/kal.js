(function(){function compile(code,options){var token_rv,raw_tokens,comments,tokens,root_node;null==options&&(options={bare:!1});try{return token_rv=lexer.tokenize(code),raw_tokens=token_rv[0],comments=token_rv[1],tokens=sugar.translate_sugar(raw_tokens,options,lexer.tokenize),root_node=parser.parse(tokens,comments,options),generator.load(parser.Grammar),root_node.js(options)}catch(e){throw e.message||e}}var sugar,lexer,parser,generator;sugar=require("./sugar"),lexer=require("./lexer"),parser=require("./parser"),generator=require("./generator"),exports.VERSION="0.4.5",exports.compile=compile,require.extensions&&(require.extensions[".kal"]=function(module,filename){var content;content=compile(require("fs").readFileSync(filename,"utf8"),{filename:filename}),module._compile(content,filename)}),exports.eval=function(code,options){var o,kobj$1,k,js,vm,path,sandbox;if(null==options&&(options={}),code=(""+code).trim(),""!==code){o={},kobj$1=options;for(k in kobj$1)kobj$1.hasOwnProperty(k)&&(o[k]=options[k]);return js=compile(code,o),options.show_js?console.log(js):void 0,vm=require("vm"),path=require("path"),sandbox=options.sandbox?options.sandbox===!0?exports.makeSandbox(options):options.sandbox:global,sandbox===global?(null==sandbox.module&&null==sandbox.require&&(sandbox=exports.makeSandbox(sandbox,options)),vm.runInThisContext(js)):vm.runInContext(js,sandbox)}},exports.makeSandbox=function(sandbox,options){var vm,path,new_sandbox,kobj$2,k,Module,_module,_require,ki$3,kobj$3,r;if(vm=require("vm"),path=require("path"),null==sandbox)sandbox=vm.createContext(global);else if(!(sandbox instanceof vm.Script.createContext().constructor)&&sandbox!==global){new_sandbox=vm.createContext(global),kobj$2=sandbox;for(k in kobj$2)kobj$2.hasOwnProperty(k)&&(new_sandbox[k]=sandbox[k]);sandbox=new_sandbox}for(sandbox.__filename=(null!=options?options.filename:void 0)||"eval",sandbox.__dirname=path.dirname(sandbox.__filename),Module=require("module"),_module=new Module((null!=options?options.modulename:void 0)||"eval"),sandbox.module=_module,_require=function(path){return Module._load(path,_module,!0)},sandbox.require=_require,_module.filename=sandbox.__filename,kobj$3=Object.getOwnPropertyNames(require),ki$3=0;kobj$3.length>ki$3;ki$3++)r=kobj$3[ki$3],"paths"!==r&&(_require[r]=require[r]);return _module.paths=Module._nodeModulePaths(process.cwd()),_require.paths=_module.paths,_require.resolve=function(request){return Module._resolveFilename(request,_module)},sandbox}})();