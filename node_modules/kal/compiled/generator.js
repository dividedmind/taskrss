(function(){function apply_generator_to_grammar(){function create_callback(){return callback_counter+=1,current_callback="k$cb"+callback_counter}function push_class(){class_defs.push(class_def),class_def={name:"",code:"",args:[],has_constructor:!1}}function pop_class(){return class_def=class_defs.pop()}function push_scope(){var new_scope,v,kobj$1,k;scopes.push(scope),try_block_stacks.push(try_block_stack),try_block_stack=[],parfor_cb_stack.push(parfor_cb),parfor_cb=null,new_scope={},current_callbacks.push(current_callback),kobj$1=scope;for(k in kobj$1)kobj$1.hasOwnProperty(k)&&(v=scope[k],"no closures"===v?v=v:"closures ok"===v||"argument"===v||"function"===v?new_scope[k]="closure":"closure"===v&&(new_scope[k]="closure"));scope=new_scope}function pop_scope(code,wrap){var rv,var_names,kobj$2,var_name;rv="",var_names=[],kobj$2=scope;for(var_name in kobj$2)kobj$2.hasOwnProperty(var_name)&&($kindexof.call(["closure","argument","function","class definition"],scope[var_name])>=0||"k$next"===var_name||var_names.push(var_name));return wrap&&(rv+="(function () {"),var_names.length>0&&(rv+="var "+var_names.join(", ")+";"),rv+=code,wrap&&(rv+="})()"),scopes!==[]&&(scope=scopes.pop()),try_block_stack=try_block_stacks.pop(),current_callback=current_callbacks.pop(),parfor_cb=parfor_cb_stack.pop(),rv}function check_existence_wrapper(code,undefined_unary,invert){var rv;return rv=undefined_unary?invert?"(typeof "+code+" === 'undefined' || "+code+" === null)":"(typeof "+code+" !== 'undefined' && "+code+" !== null)":invert?""+code+" == null":""+code+" != null"}function render_try_blocks(){var rv,ki$22,kobj$22,try_block;for(rv="",kobj$22=try_block_stack,ki$22=0;kobj$22.length>ki$22;ki$22++)try_block=kobj$22[ki$22],rv+=try_block.js_wrapper_try();return rv}function render_catch_blocks(){var rv,ki$23,kobj$23,try_block;for(rv="",kobj$23=try_block_stack,ki$23=0;kobj$23.length>ki$23;ki$23++)try_block=kobj$23[ki$23],rv+=try_block.js_wrapper_catch();return rv}var scopes,scope,try_block_stack,try_block_stacks,parfor_cb,parfor_cb_stack,callback_counter,current_callback,current_callbacks,class_defs,class_def,use_snippets,self,for_depth,while_depth,snippets;scopes=[],scope={},try_block_stack=[],try_block_stacks=[],parfor_cb=null,parfor_cb_stack=[],callback_counter=0,current_callback="k$cb0",current_callbacks=[],class_defs=[],class_def={},use_snippets={},self=this,this.File.prototype.js=function(options){var code,snip,kobj$3,key,rv,ki$4,kobj$4,comment;scopes=[],scope={},try_block_stack=[],try_block_stacks=[],parfor_cb=null,parfor_cb_stack=[],callback_counter=0,current_callback="k$cb0",current_callbacks=[],class_defs=[],class_def={name:"",code:"",args:[],has_constructor:!1},use_snippets={},this.callback=current_callback,this.bare=options.bare,code=self.Block.prototype.js.apply(this),snip=[],kobj$3=use_snippets;for(key in kobj$3)kobj$3.hasOwnProperty(key)&&snip.push(use_snippets[key]);for(snip=snip.join("\n"),rv=[snip,code].join("\n"),kobj$4=this.ts.comments,ki$4=0;kobj$4.length>ki$4;ki$4++)comment=kobj$4[ki$4],comment.written=null;return"k$cb0"!==current_callback&&(rv+="}"),pop_scope(rv,!options.bare)},this.Statement.prototype.js=function(){var rv,pf,ki$5,kobj$5,comment;for(rv="",pf="",kobj$5=this.ts.comments,ki$5=0;kobj$5.length>ki$5;ki$5++)comment=kobj$5[ki$5],comment.line<this.line+1&&!comment.written&&(comment.written=!0,comment.post_fix?(comment.multiline&&(pf+="\n"),comment.multiline||(pf+=" "),pf+="/*"+comment.value+"*/"):rv+="/*"+comment.value+"*/\n");return this.statement.in_conditional=this.in_conditional,this.statement.in_loop=this.in_loop,this.statement.parent_block=this.parent_block,this.statement.callback=this.callback,this.statement.original_callback=this.original_callback,rv+=this.statement.js(),""!==pf&&(rv.match(/\n/)?rv=rv.replace(/\n/,pf+"\n"):rv+=pf),rv},this.ThrowStatement.prototype.js=function(){var rv;return rv=0===try_block_stack.length&&null!=scope.k$next?"return k$next.apply(this, ["+this.expr.js()+"]);":"throw "+this.expr.js()+";",null!=this.conditional&&(rv=this.conditional.js(rv,!1)),rv},this.ReturnStatement.prototype.js=function(){var exprs_js,expr,arg_list,rv;return exprs_js=$kcomprl(this.exprs,function($ki){return expr=$ki,expr.js()}),null!=this.parent_block.callback?exprs_js.unshift("null"):void 0,arg_list=exprs_js.join(", "),null!=scope.k$next?(scope.k$rv="no closures",rv="k$rv = ["+arg_list+"]; return k$next.apply(this, k$rv);",null!=this.conditional&&(rv=this.conditional.js(rv,!1)),rv):(rv="return",1===this.exprs.length?rv+=" "+arg_list:this.exprs.length>1&&(rv+="["+arg_list+"]"),rv+=";",null!=this.conditional&&(rv=this.conditional.js(rv,!1)),rv)},this.ExpressionStatement.prototype.js=function(){var rv;return rv=this.expr.js(),""===rv?"":rv+";"},this.Expression.prototype.js=function(oop_reverse){var rv,left_code,opjs,ki$6,kobj$6,subscope;if(rv="",left_code=oop_reverse?"":this.left.js(),null==this.op)rv+=left_code;else if(opjs=this.op.js(),"in"===opjs&&"of"!==this.op.op.value){if(null==use_snippets["in"]){for(use_snippets["in"]=snippets["in"],kobj$6=scopes,ki$6=0;kobj$6.length>ki$6;ki$6++)subscope=kobj$6[ki$6],subscope.$kindexof="closure";scope.$kindexof="closure"}rv+="($kindexof.call("+this.right.left.js()+", "+left_code+") >= 0) "+this.right.js(!0)}else rv+="nor"===opjs?"!("+left_code+" || "+this.right.js()+")":"pow"===opjs?"Math.pow("+left_code+", "+this.right.left.js()+") "+this.right.js(!0):""+left_code+" "+opjs+" "+this.right.js();return(null!=this.op?this.op.invert:void 0)&&(rv="!("+rv+")"),null!=this.conditional&&(rv=this.conditional.js(rv,!0)),rv},this.UnaryExpression.prototype.js=function(){var rv,base_val,kw_translate,undefined_unary,existence_qualifiers,last_accessor,ki$7,kobj$7,accessor,existence_check,ki$8,kobj$8,eq,closeout;for(rv="","IDENTIFIER"===this.base.type?(base_val=this.base.value,kw_translate=KEYWORD_TRANSLATE[base_val],rv+=kw_translate||base_val,null==kw_translate&&(null!=scope[base_val]||!this.is_lvalue()||this.accessors.length>0||(scope[base_val]="closures ok"))):rv+=this.base.js(),undefined_unary="IDENTIFIER"===this.base.type&&null==scope[base_val]&&null==kw_translate,existence_qualifiers=[],last_accessor=this.accessors[this.accessors.length-1],kobj$7=this.accessors,ki$7=0;kobj$7.length>ki$7;ki$7++)accessor=kobj$7[ki$7],existence_qualifiers.push(accessor.js_existence(rv,undefined_unary,last_accessor.invert)),rv+=accessor.js(),undefined_unary=!1;for(existence_check=[],kobj$8=existence_qualifiers,ki$8=0;kobj$8.length>ki$8;ki$8++)eq=kobj$8[ki$8],""!==eq&&existence_check.push(eq);return existence_check=existence_check.join(" && "),""!==existence_check&&(last_accessor instanceof self.ExisentialCheck?rv="("+existence_check+")":(closeout="void 0",rv="(("+existence_check+") ? "+rv+" : "+closeout+")")),"new"===(null!=this.preop?this.preop.value:void 0)?rv=""+KEYWORD_TRANSLATE[this.preop.value]+" "+rv:"not"===(null!=this.preop?this.preop.value:void 0)?rv=""+KEYWORD_TRANSLATE[this.preop.value]+"("+rv+")":"-"===(null!=this.preop?this.preop.value:void 0)&&(rv="-"+rv),rv},this.WhenExpression.prototype.js=function(true_block_js,must_return_value){var conditional_js;return conditional_js=this.condition.js(),("unless"===this.specifier.value||"except"===this.specifier.value)&&(conditional_js="!("+conditional_js+")"),null!=this.false_expr?"("+conditional_js+") ? "+true_block_js+" : "+this.false_expr.js():must_return_value?"("+conditional_js+") ? "+true_block_js+" : void 0":"if ("+conditional_js+") {"+true_block_js+"}"},this.ExisentialCheck.prototype.js=function(){return""},this.ExisentialCheck.prototype.js_existence=function(accessor,undefined_unary,invert){return check_existence_wrapper(accessor,undefined_unary,invert)},this.PropertyAccess.prototype.js=function(){var rv;return rv="IDENTIFIER"===this.expr.type?this.expr.value:this.expr.js(),rv="."+rv},this.PropertyAccess.prototype.js_existence=function(accessor,undefined_unary,invert){return this.exisential?check_existence_wrapper(accessor,undefined_unary,invert):""},this.AssignmentStatement.prototype.js=function(){var op,rv;return op=this.assignOp.value,"="!==op&&(op+="="),rv=""+this.lvalue.js()+" "+op+" "+this.rvalue.js()+";",null!=this.conditional&&(rv=this.conditional.js(rv,!1)),rv},this.NumberConstant.prototype.js=function(){return this.token.text},this.StringConstant.prototype.js=function(){var rv;return rv=this.token.value},this.RegexConstant.prototype.js=function(){return this.token.text},this.BinOp.prototype.js=function(){return KEYWORD_TRANSLATE[this.op.value]||this.op.value},this.IfStatement.prototype.js=function(){var conditional_js,cb_counter,rv,ki$9,kobj$9,else_clause,inner_js;for(null==this.original_callback&&(this.original_callback=this.callback),conditional_js=this.conditional.js(),cb_counter=callback_counter,("unless"===this.condition.value||"except"===this.condition.value)&&(conditional_js="!("+conditional_js+")"),rv="if ("+conditional_js+") {",this.block.in_conditional=!0,this.block.in_loop=this.in_loop,kobj$9=this.elses,ki$9=0;kobj$9.length>ki$9;ki$9++)else_clause=kobj$9[ki$9],else_clause.block.in_conditional=!0,else_clause.block.in_loop=this.in_loop;return inner_js=this.js_no_callbacks(),this.callback===current_callback||this.is_else_if||(callback_counter=cb_counter,inner_js=this.js_callbacks()),rv+inner_js},this.IfStatement.prototype.js_no_callbacks=function(){var block_js,else_js,ki$10,kobj$10,else_clause;for(this.block.callback=this.callback,block_js=this.block.js()+this.block.js_closeout()+"}",else_js="",kobj$10=this.elses,ki$10=0;kobj$10.length>ki$10;ki$10++)else_clause=kobj$10[ki$10],else_clause.block.callback=this.callback,else_clause.block.original_callback=this.original_callback,else_js+=" else ",null!=else_clause.conditional&&(else_js+="if ("+else_clause.conditional.js()+")"),else_js+=" {",else_js+=else_clause.block.js()+else_clause.block.js_closeout(),else_js+="}";return block_js+else_js},this.IfStatement.prototype.js_callbacks=function(){var block_js,ki$11,kobj$11,else_clause,else_js,ki$12,kobj$12,callback_js;for(this.callback=create_callback(),this.block.callback=this.callback,this.block.original_callback=this.callback,block_js=this.block.js(),kobj$11=this.elses,ki$11=0;kobj$11.length>ki$11;ki$11++)else_clause=kobj$11[ki$11],else_clause.block.callback=this.callback,else_clause.block.original_callback=this.callback,else_clause.block_js=" else ",null!=else_clause.conditional&&(else_clause.block_js+="if ("+else_clause.conditional.js()+")"),else_clause.block_js+=" {",else_clause.block_js+=else_clause.block.js();for(block_js+=this.block.js_closeout()+"}",else_js="",kobj$12=this.elses,ki$12=0;kobj$12.length>ki$12;ki$12++)else_clause=kobj$12[ki$12],else_js+=else_clause.block_js+else_clause.block.js_closeout()+"}";return use_snippets.async=snippets.async,callback_js="return $kasync("+this.callback+",this);",callback_js+="function "+this.callback+"() {",callback_js+=render_try_blocks(),this.parent_block.closeout_callback=this.original_callback,create_callback(),block_js+else_js+callback_js},this.BlankStatement.prototype.js=function(){return""},for_depth=1,this.ForStatement.prototype.js=function(){var rv,iterator,terminator,loop_counter,loop_block_js;return this.callback=current_callback,this.loop_block.in_loop=!0,this.loop_block.in_conditional=this.in_conditional,rv="",iterator="ki$"+for_depth,terminator="kobj$"+for_depth,loop_counter="klc$"+for_depth,for_depth+=1,loop_block_js=this.loop_block.js()+this.loop_block.js_closeout(),this.callback!==current_callback?this.js_callbacks(iterator,terminator,loop_counter):(scope[iterator]="no closures",scope[terminator]="no closures","in"===this.type.value?(rv+=""+terminator+" = "+this.iterable.js()+";for ("+iterator+" = 0; "+iterator+" < "+terminator+".length; "+iterator+"++) {",rv+=""+this.iterant.js()+" = "+terminator+"["+iterator+"];"):(rv+=""+terminator+" = "+this.iterable.js()+";for ("+this.iterant.js()+" in "+terminator+") {",rv+="if ("+terminator+".hasOwnProperty("+this.iterant.js()+")) {"),rv+=loop_block_js,"in"!==this.type.value&&(rv+="}"),rv+="}",rv)},this.ForStatement.prototype.js_callbacks=function(iterator,terminator,loop_counter){var rv,loop_callback;return rv="","parallel"===(null!=this.execution_style?this.execution_style.value:void 0)?(loop_callback=create_callback(),this.callback=create_callback(),this.loop_block.callback=loop_callback,this.loop_block.original_callback=loop_callback,parfor_cb_stack.push(parfor_cb),parfor_cb=loop_callback,scope[iterator]="no closures",scope[terminator]="no closures",rv+="(function ("+loop_counter+") {",rv+=""+terminator+" = "+this.iterable.js()+";",rv+="in"===this.type.value?"for ("+iterator+" = 0; "+iterator+" < "+terminator+".length; "+iterator+"++) {":"for ("+iterator+" in "+terminator+") {",rv+="(function ("+this.iterant.js()+") {",rv+=render_try_blocks(),rv+=""+loop_counter+"++;",rv+=this.loop_block.js()+this.loop_block.js_closeout(),rv+=render_catch_blocks(),rv+="in"===this.type.value?"})("+terminator+"["+iterator+"]);":"})("+iterator+");",rv+="}",use_snippets.async=snippets.async,rv+="return $kasync("+loop_callback+",this);",rv+="function "+loop_callback+"() {",rv+="if (--"+loop_counter+" == 0) return "+this.callback+"();",rv+="}",rv+="})(1);",rv+="return;",rv+="function "+this.callback+"() {",rv+=render_try_blocks(),this.parent_block.closeout_callback=this.original_callback,parfor_cb=parfor_cb_stack.pop()):(this.callback=create_callback(),this.loop_block.callback="k$lcb",this.loop_block.original_callback="k$lcb",use_snippets.async=snippets.async,"in"===this.type.value?rv+="return $kasync("+loop_counter+",this,[0,"+this.iterable.js()+","+this.iterable.js()+"[0]]);":(scope[terminator]="no closures",scope[iterator]="no closures",rv+=""+terminator+" = []; for ("+iterator+" in "+this.iterable.js()+") {if (("+this.iterable.js()+").hasOwnProperty("+iterator+")) {"+terminator+".push("+iterator+")};}",rv+="return $kasync("+loop_counter+",this,[0,"+terminator+","+terminator+"[0]]);"),rv+="function "+loop_counter+" (k$i,k$obj,"+this.iterant.js()+") {",rv+=render_try_blocks(),rv+="k$i++;",rv+="var k$lcb = function () {if (k$i < k$obj.length) return "+loop_counter+".apply(this,[k$i,k$obj,k$obj[k$i]]); else return "+this.callback+".apply(this);};",rv+=this.loop_block.js()+this.loop_block.js_closeout(),rv+=render_catch_blocks(),rv+="}",rv+="function "+this.callback+"() {",rv+=render_try_blocks(),this.parent_block.closeout_callback=this.original_callback),rv},while_depth=1,this.WhileStatement.prototype.js=function(){var rv;return this.block.in_loop=!0,this.block.in_conditional=this.in_conditional,rv="while ("+this.expr.js()+") {",rv+=this.block.js()+this.block.js_closeout(),rv+="}",this.callback!==current_callback?this.js_callbacks():rv},this.WhileStatement.prototype.js_callbacks=function(){var rv,while_wrapper;return rv="",while_depth+=1,while_wrapper="kw$"+while_depth,this.callback=create_callback(),this.block.callback="k$lcb",this.block.original_callback="k$lcb",use_snippets.async=snippets.async,rv+="return "+while_wrapper+"();",rv+="function "+while_wrapper+" () {",rv+=render_try_blocks(),rv+="var k$lcb = function () {if ("+this.expr.js()+") return $kasync("+while_wrapper+",this); else return $kasync("+this.callback+",this);};",rv+=this.block.js()+this.block.js_closeout(),rv+=render_catch_blocks(),rv+="}",rv+="function "+this.callback+"() {",rv+=render_try_blocks(),this.parent_block.closeout_callback=this.original_callback,rv},this.Block.prototype.js=function(){var previous_cb,rv,ki$13,kobj$13,statement;for(null==this.callback&&(this.callback=current_callback),null==this.original_callback&&(this.original_callback=current_callback),previous_cb=current_callback,this.callbacks=[],rv=[],kobj$13=this.statements,ki$13=0;kobj$13.length>ki$13;ki$13++)statement=kobj$13[ki$13],statement.parent_block=this,statement.callback=this.callback,statement.original_callback=this.original_callback,statement.in_conditional=this.in_conditional,statement.in_loop=this.in_loop,rv.push(statement.js()),current_callback!==previous_cb&&(this.callbacks.unshift(this.callback),this.callback=current_callback,previous_cb=current_callback);return rv=rv.join("\n"),this.callbacks.length>0&&null!=scope.k$next&&(rv+="var k$done = (typeof k$next == 'function') ? k$next : function (){}; k$next=function (){}; return k$done();"),rv},this.Block.prototype.js_closeout=function(){var rv,ki$14,kobj$14,callback;for(rv="",null!=this.closeout_callback&&0!==this.callbacks.length&&(this.in_conditional||this.in_loop)&&(use_snippets.async=snippets.async,rv+="return $kasync("+this.closeout_callback+",this);"),kobj$14=this.callbacks,ki$14=0;kobj$14.length>ki$14;ki$14++)callback=kobj$14[ki$14],rv+=render_catch_blocks(),rv+="}";return rv},this.ParenExpression.prototype.js=function(){return"("+this.expr.js()+")"},this.IndexExpression.prototype.js=function(){return"["+this.expr.js()+"]"},this.IndexExpression.prototype.js_existence=function(accessor,undefined_unary,invert){return this.exisential?check_existence_wrapper(accessor,undefined_unary,invert):""},this.ListExpression.prototype.js=function(){var rv,ki$15,kobj$15,item;if(null==this.comprehension){for(rv=[],kobj$15=this.items,ki$15=0;kobj$15.length>ki$15;ki$15++)item=kobj$15[ki$15],rv.push(item.js());return rv=rv.join(", "),"["+rv+"]"}return this.comprehension.js()},this.ListComprehension.prototype.js=function(){var rv;return use_snippets["array list comprehension"]=snippets["array list comprehension"],scope[this.iterant.value]="closures ok",rv="$kcomprl("+this.iterable.js()+",function($ki){"+this.iterant.value+" = $ki;return "+this.iter_expr.js()+";})"},this.ObjectComprehension.prototype.js=function(){var rv;return use_snippets["object list comprehension"]=snippets["object list comprehension"],rv="",null!=this.property_iterant&&(scope[this.property_iterant.value]="closures ok",rv+=""+this.property_iterant.value+" = $kp;"),null!=this.value_iterant&&(scope[this.value_iterant.value]="closures ok",rv+=""+this.value_iterant.value+" = $kv;"),rv="$kcompro("+this.iterable.js()+",function($kp,$kv){"+rv+";return "+this.iter_expr.js()+";})"},this.MapItem.prototype.js=function(){return""+this.key.js()+": "+this.val.js()},this.MapExpression.prototype.js=function(){var rv,ki$16,kobj$16,item;for(rv=[],kobj$16=this.items,ki$16=0;kobj$16.length>ki$16;ki$16++)item=kobj$16[ki$16],rv.push(item.js());return rv=rv.join(", "),"{ "+rv+" }"},this.FunctionExpression.prototype.js=function(){return this.args=[],"task"===this.specifier.value&&(this.callback="k$next"),class_defs.length>0&&null!=this.name?"method"===this.specifier.value&&"initialize"===this.name.value?(class_def.code+=this.js_constructor(),""):this.js_class_member():this.js_bare_function()},this.FunctionExpression.prototype.js_bare_function=function(){var rv,ki$17,kobj$17,argument;for(rv="function ",null!=this.name&&(rv+=this.name.value),kobj$17=this.arguments,ki$17=0;kobj$17.length>ki$17;ki$17++)argument=kobj$17[ki$17],this.args.push(argument.name.value);return rv+this.js_body()},this.FunctionExpression.prototype.js_class_member=function(){var rv,ki$18,kobj$18,argument;for(rv="method"===this.specifier.value?""+class_def.name+".prototype."+this.name.value+" = function":""+class_def.name+"."+this.name.value+" = function",kobj$18=this.arguments,ki$18=0;kobj$18.length>ki$18;ki$18++)argument=kobj$18[ki$18],this.args.push(argument.name.value);return rv+this.js_body()},this.FunctionExpression.prototype.js_constructor=function(){var rv,ki$19,kobj$19,argument;for(class_def.has_constructor=!0,rv="function "+class_def.name,class_def.args=[],kobj$19=this.arguments,ki$19=0;kobj$19.length>ki$19;ki$19++)argument=kobj$19[ki$19],class_def.args.push(argument.name.value);return this.args=class_def.args,rv+=this.js_body(class_def.args),null!=this.callback_arg?class_def.args.push(this.callback_arg):void 0,rv},this.FunctionExpression.prototype.js_body=function(){var rv,ki$20,kobj$20,arg_name,block_code;for(rv="",push_scope(),null!=this.callback&&(scope.k$next=this.callback),kobj$20=this.args,ki$20=0;kobj$20.length>ki$20;ki$20++)arg_name=kobj$20[ki$20],scope[arg_name]="argument";return block_code=this.block.js(!0)+this.block.js_closeout(),null!=this.callback&&(this.args.push(this.callback),block_code="try {"+block_code),rv+=pop_scope(block_code,!1),null!=this.callback&&(rv+="} catch (k$err) {if (k$next) {return k$next.apply(this,[k$err]);} else {throw k$err;}}",rv+="return k$next ? k$next() : void 0;"),rv+="}",rv=" ("+this.args.join(", ")+") {"+rv},this.FunctionCall.prototype.js=function(as_list){var rv,ki$21,kobj$21,argument;for(rv=[],kobj$21=this.arguments,ki$21=0;kobj$21.length>ki$21;ki$21++)argument=kobj$21[ki$21],rv.push(argument.js());return null!=this.callback_name?rv.push(this.callback_name):void 0,rv=rv.join(", "),as_list?"["+rv+"]":"("+rv+")"},this.FunctionCall.prototype.js_existence=function(accessor,undefined_unary,invert){return this.exisential?check_existence_wrapper(accessor,undefined_unary,invert):""},this.FunctionCallArgument.prototype.js=function(){return this.val.js()},this.ClassDefinition.prototype.js=function(){var block_code,rv;return push_scope(),push_class(),class_def.name=this.name.value,class_def.parent=null!=this.parent?this.parent.value:void 0,block_code=this.block.js()+this.block.js_closeout(),block_code=pop_scope(block_code,!1),rv=class_def.code,class_def.has_constructor||(rv+="function "+class_def.name+" () {",null!=this.parent&&(rv+="return "+this.parent.value+".prototype.constructor.apply(this,arguments);"),rv+="}"),null!=this.parent&&(rv+="__extends("+this.name.value+","+this.parent.value+");",use_snippets.inherits=snippets.inherits),rv+=block_code,pop_class(),rv},this.TryCatch.prototype.js=function(){var rv;return try_block_stack.unshift(this),this.try_block.in_conditional=!0,this.try_block.in_loop=this.in_loop,null==this.original_callback&&(this.original_callback=this.callback),rv=this.js_no_callbacks(),this.callback!==current_callback?(this.callback=create_callback(),this.closeout_callback=this.callback,rv=this.js_callbacks()):try_block_stack.shift(),rv},this.TryCatch.prototype.js_no_callbacks=function(){var rv;return rv=this.js_wrapper_try(),this.try_block.original_callback=this.original_callback,rv+=this.try_block.js()+this.try_block.js_closeout(),rv+=this.js_wrapper_catch()},this.TryCatch.prototype.js_callbacks=function(){var rv;return rv=this.js_wrapper_try(),this.try_block.original_callback=this.callback,rv+=this.try_block.js()+this.try_block.js_closeout(),rv+=this.js_wrapper_catch(),rv+="function "+this.callback+"() {",try_block_stack.shift(),rv+=render_try_blocks(),this.parent_block.closeout_callback=this.original_callback,rv},this.TryCatch.prototype.js_wrapper_try=function(){var rv;return rv="try {"},this.TryCatch.prototype.js_wrapper_catch=function(){var rv,loop_clearout_js;return null!=try_block_stack[0]&&(try_block_stack[0].in_catch=!0),rv="}",loop_clearout_js="",null!=this.catch_block?(rv+=" catch ("+((null!=this.identifier?this.identifier.value:void 0)||"k$e")+") {",rv+=this.catch_block.js()+this.catch_block.js_closeout()):rv+=" catch (k$e) {",null!=parfor_cb?rv+="return "+parfor_cb+"();":null!=this.closeout_callback&&(rv+="return "+this.closeout_callback+"();"),rv+="}",null!=try_block_stack[0]&&(try_block_stack[0].in_catch=!1),rv},this.SuperStatement.prototype.js=function(){var rv;return null==class_def.parent?"":(rv=""+class_def.parent+".prototype.constructor.apply(this,",rv+=null!=this.accessor?this.accessor.js(!0):"arguments",rv+=");")},this.WaitForStatement.prototype.js=function(){var prefix,rv,rv_block,arg_i,ki$24,kobj$24,argument;if(null!=try_block_stack[0]?try_block_stack[0].in_catch:void 0)throw Error("wait fors not supported in catch blocks");for(prefix=this.parent_block.bare?"":"return ",this.new_callback=create_callback(),this.rvalue.callback_args=this.lvalue,this.rvalue.accessors[this.rvalue.accessors.length-1].callback_name=this.new_callback,rv=""+prefix+this.rvalue.js()+";",null!=this.conditional&&(rv=this.conditional.js(rv,!1),rv+=""+prefix+this.new_callback+"();"),rv_block="",arg_i=this.no_errors?0:1,kobj$24=this.lvalue.arguments,ki$24=0;kobj$24.length>ki$24;ki$24++)argument=kobj$24[ki$24],rv_block+=""+argument.base.value+" = arguments["+arg_i+"];",null==scope[argument.base.value]&&(scope[argument.base.value]="closures ok"),arg_i+=1;return this.block.in_conditional=this.in_conditional,this.block.in_loop=this.in_loop,rv_block+=this.block.js(),rv+="function "+this.new_callback+" () {",rv+=render_try_blocks(),this.no_errors||(rv+="if (arguments[0] != null) throw arguments[0];"),rv+=rv_block,this.in_conditional||this.in_loop?(use_snippets.async=snippets.async,rv+=""+prefix+"$kasync("+this.parent_block.callback+",this);"):scope.k$next&&(rv+=""+prefix+"k$next ? k$next() : void 0;"),rv+=this.block.js_closeout()},snippets={"in":"var $kindexof = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };",inherits:"var __hasProp = {}.hasOwnProperty, __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }","array list comprehension":'var $kcomprl = function (iterable,func) {var o = []; if (iterable instanceof Array) {for (var i=0;i<iterable.length;i++) {o.push(func(iterable[i]));}} else if (typeof(iterable.next) == "function") {var i; while ((i = iterable.next()) != null) {o.push(func(i));}} else {throw "Object is not iterable";}return o;};',"object list comprehension":"var $kcompro = function (obj,func) {var o = []; for (var k in obj) {o.push(func(k,obj[k]));}return o;}",async:'var $kasync = (typeof process === "undefined" || !(process.nextTick)) ? (function (fn,self,args) {setTimeout(function () {fn.apply(self,args);}, 0);}) : (function (fn,self,args) {process.nextTick(function () {fn.apply(self,args);});});'}}var KEYWORD_TRANSLATE,load,$kindexof=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},$kcomprl=function(iterable,func){var o=[];if(iterable instanceof Array)for(var i=0;iterable.length>i;i++)o.push(func(iterable[i]));else{if("function"!=typeof iterable.next)throw"Object is not iterable";for(var i;null!=(i=iterable.next());)o.push(func(i))}return o};KEYWORD_TRANSLATE={yes:"true",on:"true",no:"false",off:"false",is:"===",isnt:"!==","==":"===","!=":"!==",and:"&&",but:"&&",or:"||",xor:"^","^":"pow",not:"!","new":"new ",me:"this","this":"this","null":"null",nothing:"null",none:"null","break":"break","throw":"throw",raise:"throw","instanceof":"instanceof",of:"in",EndOfList:"undefined",fail:"throw"},load=function load(grammar){apply_generator_to_grammar.apply(grammar)},exports.load=load})();